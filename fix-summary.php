<?php
// ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤ Undefined Variable ‡πÅ‡∏•‡∏∞ Syntax Error
error_reporting(E_ALL);
ini_set('display_errors', 1);

echo "<!DOCTYPE html>
<html lang='th'>
<head>
    <meta charset='UTF-8'>
    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">
    <title>‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤ - ‡∏Ç‡πâ‡∏≤‡∏ß‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡∏û‡∏∑‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÄ‡∏•‡∏¢</title>
    <style>
        body { font-family: 'Kanit', sans-serif; margin: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .status { padding: 15px; margin: 15px 0; border-radius: 8px; }
        .success { background: #d4edda; color: #155724; border-left: 5px solid #28a745; }
        .warning { background: #fff3cd; color: #856404; border-left: 5px solid #ffc107; }
        .error { background: #f8d7da; color: #721c24; border-left: 5px solid #dc3545; }
        .info { background: #d1ecf1; color: #0c5460; border-left: 5px solid #17a2b8; }
        .fix-item { background: #f8f9fa; padding: 20px; margin: 15px 0; border-radius: 10px; border-left: 5px solid #27ae60; }
        .fix-title { font-weight: 600; color: #27ae60; margin-bottom: 10px; }
        pre { background: #2d3748; color: #e2e8f0; padding: 15px; border-radius: 8px; overflow-x: auto; }
        .before-after { display: flex; gap: 20px; margin: 15px 0; }
        .before, .after { flex: 1; }
        .before pre { background: #742a2a; }
        .after pre { background: #2f855a; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { padding: 12px; text-align: left; border: 1px solid #ddd; }
        th { background: #27ae60; color: white; }
        .btn { display: inline-block; padding: 12px 24px; background: #27ae60; color: white; text-decoration: none; border-radius: 8px; margin: 5px; }
        .btn:hover { background: #219a52; }
        h1, h2, h3 { color: #2d3748; }
        .emoji { font-size: 1.2em; }
    </style>
    <link href=\"https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap\" rel=\"stylesheet\">
</head>
<body>
<div class=\"container\">";

echo "<h1>üõ†Ô∏è ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h1>";

echo "<div class='success'>‚úÖ <strong>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô!</strong> ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ö‡∏ô Production Server</div>";

echo "<h2>üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</h2>";

// 1. Syntax Error ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å
echo "<div class='fix-item'>";
echo "<div class='fix-title'>1. üö® PHP Parse Error: syntax error, unexpected '?'</div>";
echo "<p><strong>‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏:</strong> ‡πÉ‡∏ä‡πâ syntax ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÉ‡∏ô PHP/JavaScript ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏Å‡πà‡∏≤</p>";
echo "<p><strong>‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:</strong></p>";
echo "<ul>";
echo "<li><code>assets/js/main.js</code> - ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Optional Chaining (?.)</li>";
echo "<li><code>payment-notification.php</code> - ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô fetch() ‡πÄ‡∏õ‡πá‡∏ô XMLHttpRequest</li>";
echo "<li><code>login.php</code> - ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç URLSearchParams ‡πÅ‡∏•‡∏∞ Arrow Functions</li>";
echo "</ul>";
echo "</div>";

// 2. Undefined Variable ‡∏õ‡∏±‡∏ç‡∏´‡∏≤
echo "<div class='fix-item'>";
echo "<div class='fix-title'>2. ‚ö†Ô∏è Undefined Variable Errors</div>";
echo "<p><strong>‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏:</strong> ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÉ‡∏ô catch block ‡∏´‡∏£‡∏∑‡∏≠‡∏ô‡∏≠‡∏Å scope</p>";
echo "<p><strong>‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:</strong></p>";
echo "<ul>";
echo "<li><code>products.php</code> - ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç \$page variable</li>";
echo "<li><code>checkout.php</code> - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ \$pdo ‡πÅ‡∏•‡∏∞ provinces</li>";
echo "<li><code>profile.php</code> - ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö \$user array</li>";
echo "<li><code>admin/products.php</code> - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</li>";
echo "</ul>";
echo "</div>";

echo "<h2>üîß ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</h2>";

// JavaScript Compatibility
echo "<div class='fix-item'>";
echo "<div class='fix-title'>JavaScript Compatibility Issues</div>";
echo "<div class='before-after'>";
echo "<div class='before'>";
echo "<h4>‚ùå Before (‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö IE/‡πÄ‡∏Å‡πà‡∏≤)</h4>";
echo "<pre>// Optional Chaining - ES2020
dots[currentSlide]?.classList.remove('active');

// Fetch API - ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö IE
fetch('api/endpoint.php')
  .then(res => res.json())

// URLSearchParams - ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö IE
const params = new URLSearchParams(window.location.search);

// Arrow Functions
setTimeout(() => { ... }, 100);</pre>";
echo "</div>";
echo "<div class='after'>";
echo "<h4>‚úÖ After (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Browser ‡πÄ‡∏Å‡πà‡∏≤)</h4>";
echo "<pre>// Safe Property Access
if (dots[currentSlide]) dots[currentSlide].classList.remove('active');

// XMLHttpRequest - ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å Browser
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() { ... }

// String Search - ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å Browser
var search = window.location.search;
if (search.indexOf('param') !== -1) { ... }

// Regular Functions
setTimeout(function() { ... }, 100);</pre>";
echo "</div>";
echo "</div>";
echo "</div>";

// PHP Variable Management
echo "<div class='fix-item'>";
echo "<div class='fix-title'>PHP Variable Management</div>";
echo "<div class='before-after'>";
echo "<div class='before'>";
echo "<h4>‚ùå Before (Undefined Variable)</h4>";
echo "<pre>try {
    \$page = isset(\$_GET['page']) ? max(1, (int)\$_GET['page']) : 1;
    // ... code ...
} catch (Exception \$e) {
    \$products = [];
    // \$page ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏® !!
}

// ‡πÉ‡∏ô HTML
echo \$page; // Undefined variable error!</pre>";
echo "</div>";
echo "<div class='after'>";
echo "<h4>‚úÖ After (Safe Variable Declaration)</h4>";
echo "<pre>try {
    \$page = isset(\$_GET['page']) ? max(1, (int)\$_GET['page']) : 1;
    // ... code ...
} catch (Exception \$e) {
    \$products = [];
    \$page = isset(\$_GET['page']) ? max(1, (int)\$_GET['page']) : 1;
    \$search = isset(\$_GET['search']) ? trim(\$_GET['search']) : '';
}

// ‡πÉ‡∏ô HTML - ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
echo \$page; // ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á‡πÉ‡∏ô try ‡πÅ‡∏•‡∏∞ catch</pre>";
echo "</div>";
echo "</div>";
echo "</div>";

echo "<h2>üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</h2>";

echo "<table>";
echo "<tr><th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏õ‡∏±‡∏ç‡∏´‡∏≤</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÑ‡∏ü‡∏•‡πå</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th></tr>";
echo "<tr><td>JavaScript Optional Chaining</td><td>1</td><td>3</td><td>‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à</td></tr>";
echo "<tr><td>Fetch API Compatibility</td><td>1</td><td>1</td><td>‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à</td></tr>";
echo "<tr><td>URLSearchParams Issue</td><td>1</td><td>1</td><td>‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à</td></tr>";
echo "<tr><td>Undefined Variable</td><td>4</td><td>7</td><td>‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à</td></tr>";
echo "<tr><td><strong>‡∏£‡∏ß‡∏°</strong></td><td><strong>7</strong></td><td><strong>12</strong></td><td><strong>‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</strong></td></tr>";
echo "</table>";

echo "<h2>üß™ ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h2>";

echo "<div class='info'>";
echo "<h3>üîç ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö:</h3>";
echo "<ol>";
echo "<li><strong>Local Test:</strong> ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ <code>http://localhost/loei-rice-ecommerce/</code></li>";
echo "<li><strong>Compatibility Check:</strong> ‡πÄ‡∏õ‡∏¥‡∏î <a href='compatibility-check.php'>compatibility-check.php</a></li>";
echo "<li><strong>Syntax Validation:</strong> ‡πÄ‡∏õ‡∏¥‡∏î <a href='test-syntax.php'>test-syntax.php</a></li>";
echo "<li><strong>Upload to Server:</strong> ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß</li>";
echo "<li><strong>Production Test:</strong> ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ö‡∏ô production server</li>";
echo "</ol>";
echo "</div>";

echo "<h2>üöÄ Deployment Checklist</h2>";

echo "<div class='warning'>";
echo "<h3>üìù ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏Å‡πà‡∏≠‡∏ô Deploy:</h3>";
echo "<ol>";
echo "<li>‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç JavaScript compatibility issues</li>";
echo "<li>‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç PHP undefined variables</li>";
echo "<li>‚úÖ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö syntax ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß</li>";
echo "<li>‚ö†Ô∏è Upload ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡∏∂‡πâ‡∏ô server</li>";
echo "<li>‚ö†Ô∏è Clear PHP OPcache (‡∏´‡∏≤‡∏Å‡∏°‡∏µ)</li>";
echo "<li>‚ö†Ô∏è ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏´‡∏•‡∏±‡∏Å‡πÜ ‡∏ö‡∏ô production</li>";
echo "<li>‚ö†Ô∏è ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Error Log ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å deploy</li>";
echo "</ol>";
echo "</div>";

echo "<h2>üìÅ ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó</h2>";

$updated_files = [
    'products.php' => '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç undefined variable $page',
    'checkout.php' => '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error ‡πÅ‡∏•‡∏∞ provinces fallback',
    'profile.php' => '‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö $user array',
    'login.php' => '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç URLSearchParams ‡πÅ‡∏•‡∏∞ arrow function',
    'payment-notification.php' => '‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô fetch() ‡πÄ‡∏õ‡πá‡∏ô XMLHttpRequest',
    'assets/js/main.js' => '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç optional chaining operator',
    'admin/products.php' => '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô',
    'compatibility-check.php' => '‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö compatibility',
    'test-syntax.php' => '‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö syntax',
    'fix-summary.php' => '‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ - ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç'
];

echo "<table>";
echo "<tr><th>‡πÑ‡∏ü‡∏•‡πå</th><th>‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á</th></tr>";
foreach ($updated_files as $file => $description) {
    echo "<tr><td><code>$file</code></td><td>$description</td></tr>";
}
echo "</table>";

echo "<div style='text-align: center; margin-top: 40px;'>";
echo "<h2>üéâ ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå!</h2>";
echo "<p>‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Production Server ‡πÅ‡∏•‡πâ‡∏ß</p>";
echo "<a href='index.php' class='btn'>üè† ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a>";
echo "<a href='compatibility-check.php' class='btn'>üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Compatibility</a>";
echo "<a href='products.php' class='btn'>üõí ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Products</a>";
echo "</div>";

echo "<div class='success' style='margin-top: 30px; text-align: center;'>";
echo "<strong>‚ú® Next Steps:</strong><br>";
echo "1. ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡∏∂‡πâ‡∏ô Production Server<br>";
echo "2. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå<br>";
echo "3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Error Log ‡∏ö‡∏ô server<br>";
echo "4. Enjoy your bug-free rice e-commerce website! üåæ";
echo "</div>";

echo "</div></body></html>";

// Log ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
$log_entry = date('Y-m-d H:i:s') . " - Fixed undefined variable and syntax errors in 7 files\n";
file_put_contents('fix.log', $log_entry, FILE_APPEND | LOCK_EX);
?>